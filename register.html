<!DOCTYPE HTML>
<html>

<head>
	<!-- <link rel="stylesheet" href="styles.css"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Submission script derived from https://stackoverflow.com/a/19843756 -->
	<script>
	function submitForm(form) {
		let xhr = new XMLHttpRequest();
		let action = form.target || form.explicitOriginalTarget;
		xhr.onload = function() { alert("Got " + xhr.responseText); };
		xhr.open("post", action, true);
		let data = "<user><first_name>" + form.fname + "</first_name>" +
			"<last_name>" + form.lname + "</last_name>" +
			"<email>" + form.email + "</email>" +
			"<password>" + form.pwd + "</password></user>";
		xhr.setRequestHeader("Content-Type", "application/xml");
		xhr.send(data);
		return false;
	}
	</script>
</head>

<title>New User Registration</title>

<body>
	<!-- Ensure that the submitForm function runs from anywhere the form is submitted -->
	<body onload="var forms = document.getElementById('reg_form');
              for (var i = 0; i < forms.length; ++i)
                 forms.item(i).onsubmit = submitForm;">
	<fieldset>
    <form action="register.xml" id="reg_form" method="post">
        First Name: <input type="text" id="fname" required><br>
        Last Name: <input type="text" id="lname" required><br>
        E-Mail: <input type="email" id="email" required><br>
        Password: <input type="password" id="pwd" minlength=10 maxlength=128 required onkeyup="validatePassword()"><br>
		<div id="pwd_requirements" hidden=true>
			Password must meet at least 3 of the following requirements:
			<ul><li>1 uppercase character<br>
			<li>1 lowercase character<br>
			<li>1 digit<br>
			<li>1 special character<br></ul>
			In addition to being between 10 to 128 characters long.</div>
        Confirm Password: <input type="password" id="confirm_pwd" required onkeyup="validatePassword()"><br>
        <input type="submit" value="Register">
	</form>
	<script>'use strict'
	function validatePassword() {
			let pwd = document.getElementById("pwd");
			if(/(.)\1\1/.test(pwd.value)) {
				pwd.setCustomValidity("Password must not contain 3 of the same character in a row.");
				return false;
			}
			let criteria = 0;
			if(/[a-z]/.test(pwd.value)) { criteria++; }
			if(/[A-Z]/.test(pwd.value)) { criteria++; }
			if(/[0-9]/.test(pwd.value)) { criteria++; }
			if(/[ !@#$%^&*)(_\-+=}\]{\["':;?/>.<,]/.test(pwd.value)) { criteria++; }
			let pwd_requirements = document.getElementById("pwd_requirements");
			if(criteria < 3) {
				pwd.setCustomValidity("Password does not meet requirements.");
				pwd_requirements.hidden=false;
				return false;
			}
			else {
				pwd.setCustomValidity("");
				pwd_requirements.hidden=true;
			}
			let confirm_pwd = document.getElementById("confirm_pwd");
			if(pwd.value !== confirm_pwd.value) {
				confirm_pwd.setCustomValidity("Passwords must match.");
				return false;
			} else {
				confirm_pwd.setCustomValidity("");
				return true;
			}
	}
	</script>
	</fieldset>
</body>

</html>
