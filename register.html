<!DOCTYPE HTML>
<html>

<head>
	<!-- <link rel="stylesheet" href="styles.css"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Submission script derived from https://stackoverflow.com/a/19843756 -->
	<script>
	'use strict'
	function submitForm(form) {
		if(!form.checkValidity()) { return; }
		let xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				alert("Got " + xhr.responseText);
			}
		};
		xhr.open("POST", form.action, true);
		let data = "<first_name>" + form.fname.value + "</first_name>" +
			"<last_name>" + form.lname.value + "</last_name>" +
			"<address>" + form.address.value + "</address>" +
			"<password>" + form.pwd.value + "</password>";
		console.log(data);
		xhr.setRequestHeader("Content-Type", "application/xml");
		xhr.send(data);
	}
	</script>
</head>

<title>New User Registration</title>

<body>
	<fieldset>
    <form method="post" action="register.html" id="reg_form" onsubmit="submitForm(this);return false;">
        First Name: <input type="text" id="fname" title="Alphabet only" pattern="[a-zA-Z]+" required><br>
        Last Name: <input type="text" id="lname" title="Alphabet only" pattern="[a-zA-Z]+" required><br>
        Address: <input type="address" id="text" title="Alphanumeric plus .,# only" pattern="[a-zA-Z#.,]+" required><br>
        Password: <input type="password" id="pwd" minlength=10 maxlength=128 required onkeyup="validatePassword()"><br>
		<details style="border:1px solid red;" id="pwd_requirements" open=true hidden=true>
			Password must meet at least 3 of the following requirements:
			<ul><li>1 uppercase character<br>
			<li>1 lowercase character<br>
			<li>1 digit<br>
			<li>1 special character<br></ul>
			In addition to being between 10 to 128 characters long.</details>
        Confirm Password: <input type="password" id="confirm_pwd" required onkeyup="validatePassword()"><br>
        <input type="submit">
	</form>
	<script>'use strict'
	function validatePassword() {
			let pwd = document.getElementById("pwd");
			if(/(.)\1\1/.test(pwd.value)) {
				pwd.setCustomValidity("Password must not contain 3 of the same character in a row.");
				return false;
			}
			let criteria = 0;
			if(/[a-z]/.test(pwd.value)) { criteria++; }
			if(/[A-Z]/.test(pwd.value)) { criteria++; }
			if(/[0-9]/.test(pwd.value)) { criteria++; }
			if(/[ !@#$%^&*)(_\-+=}\]{\["':;?/>.<,]/.test(pwd.value)) { criteria++; }
			let pwd_requirements = document.getElementById("pwd_requirements");
			if(criteria < 3) {
				pwd.setCustomValidity("Password does not meet requirements.");
				pwd_requirements.hidden=false;
				return false;
			}
			else {
				pwd.setCustomValidity("");
				pwd_requirements.hidden=true;
			}
			let confirm_pwd = document.getElementById("confirm_pwd");
			if(pwd.value !== confirm_pwd.value) {
				confirm_pwd.setCustomValidity("Passwords must match.");
				return false;
			} else {
				confirm_pwd.setCustomValidity("");
				return true;
			}
	}
	</script>
	</fieldset>
</body>

</html>
